plugins {
  id "us.ihmc.gradle.ihmc-build" version "0.0.19"
}

apply plugin: 'java'
apply plugin: 'maven-publish'

sourceCompatibility = 1.8
version = '0.9.2'

project.ext.fullVersion = version
project.ext.vcsUrl = "https://github.com/ihmcrobotics/ihmc-continuous-integration-framework"
project.ext.licenseURL = "http://www.apache.org/licenses/LICENSE-2.0.txt"
project.ext.licenseName = "Apache License, Version 2.0"
project.ext.bintrayLicenseName = "Apache-2.0"

project.sourceSets {
   testsrc {
      java {
         srcDirs = ['test-src']
      }
   }
}

jar {
   from sourceSets.testsrc.output
   manifest {
      attributes(
      "Created-By": "IHMC Gradle Build Script",
      "Implementation-Title": project.name,
      "Implementation-Version": project.version,
      "Implementation-Vendor": "IHMC",

      "Bundle-Name": project.name,
      "Bundle-Version": project.version,
      "Bundle-License": "http://www.apache.org/licenses/LICENSE-2.0.txt",
      "Bundle-Vendor": "IHMC")
   }
}

task sourceJar(type: Jar) {
   from sourceSets.testsrc.allJava
}

publishing {
	publications {
	    mavenJava(MavenPublication) {
	        groupId 'us.ihmc'
	        artifactId project.name
	        version "$version"
	        from components.java
	
	        pom.withXml {
                asNode().children().last() + {
                    resolveStrategy = Closure.DELEGATE_FIRST
                    name project.name
                    url 'https://github.com/ihmcrobotics/ihmc-continuous-integration-framework'
                    licenses {
                        license {
                            name 'Apache License, Version 2.0'
                            url 'http://www.apache.org/licenses/LICENSE-2.0.txt'
                            distribution 'repo'
                        }
                    }
                }
            }
	
	        artifact sourceJar {
	            classifier "sources"
	        }
	    }
	}
}

def labels = ['ihmc', 'robotics', 'java', 'infrastructure']
ihmc.configureForIHMCOpenSourceBintrayPublish(false, "mavenJava", "maven-release", labels)

repositories ihmc.ihmcDefaultArtifactProxies()

repositories {
    mavenLocal()
    jcenter()
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.11'
}
